# --------------------------------------------------------------------------------
#       Copyright (c) 2018-2020 Sarah Edwards (Station X Labs, LLC, 
#       @iamevltwin, mac4n6.com). All rights reserved.

#       This software is provided "as is," without warranty of any kind,
#       express or implied.  In no event shall the author or contributors
#       be held liable for any damages arising in any way from the use of
#       this software.

#       The contents of this file are DUAL-LICENSED.  You may modify and/or
#       redistribute this software according to the terms of one of the
#       following two licenses (at your option):

#       LICENSE 1 ("BSD-like with acknowledgment clause"):

#       Permission is granted to anyone to use this software for any purpose,
#       including commercial applications, and to alter it and redistribute
#       it freely, subject to the following restrictions:

#       1. Redistributions of source code must retain the above copyright
#          notice, disclaimer, and this list of conditions.
#       2. Redistributions in binary form must reproduce the above copyright
#          notice, disclaimer, and this list of conditions in the documenta-
#          tion and/or other materials provided with the distribution.
#       3. All advertising, training, and documentation materials mentioning 
#          features or use of this software must display the following 
#          acknowledgment. Character-limited social media may abbreviate this 
#          acknowledgment to include author and APOLLO name ie: "This new 
#          feature brought to you by @iamevltwin's APOLLO". Please make an 
#          effort credit the appropriate authors on specific APOLLO modules.
#          The spirit of this clause is to give public acknowledgment to 
#          researchers where credit is due.

#             This product includes software developed by Sarah Edwards 
#             (Station X Labs, LLC, @iamevltwin, mac4n6.com) and other 
#             contributors as part of APOLLO (Apple Pattern of Life Lazy 
#             Output'er). 


#       LICENSE 2 (GNU GPL v3 or later):

#       This file is part of APOLLO (Apple Pattern of Life Lazy Output'er).

#       APOLLO is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       (at your option) any later version.

#       APOLLO is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.

#       You should have received a copy of the GNU General Public License
#       along with APOLLO.  If not, see <https://www.gnu.org/licenses/>.
# --------------------------------------------------------------------------------


[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Contact Interaction

[Database Metadata]
DATABASE=interactionC.db
PLATFORM=IOS,MACOS
VERSIONS=9,10,11,12,13,10.15,10.16,14

[Query Metadata]
QUERY_NAME=interaction_contact_interactions
ACTIVITY=Contact Interaction
KEY_TIMESTAMP=START DATE

[SQL Query 13,10.15,10.16,14]
QUERY=
   SELECT
      DATETIME(ZINTERACTIONS.ZSTARTDATE + 978307200, 'UNIXEPOCH') AS 'START DATE',
      DATETIME(ZINTERACTIONS.ZENDDATE + 978307200, 'UNIXEPOCH') AS 'END DATE',
      ZINTERACTIONS.ZBUNDLEID AS 'BUNDLE ID',
      ZINTERACTIONS.ZACCOUNT AS 'ACCOUNT',
      ZINTERACTIONS.ZTARGETBUNDLEID AS 'TARGET BUNDLE ID',
      CASE ZINTERACTIONS.ZDIRECTION
         WHEN '0' THEN 'INCOMING'
         WHEN '1' THEN 'OUTGOING'
      END 'DIRECTION',
      ZCONTACTS.ZDISPLAYNAME AS 'SENDER DISPLAY NAME',
      ZCONTACTS.ZIDENTIFIER AS 'SENDER IDENTIFIER',
      ZCONTACTS.ZPERSONID AS 'SENDER PERSONID',
      RECEIPIENTCONACT.ZDISPLAYNAME AS 'RECIPIENT DISPLAY NAME',
      RECEIPIENTCONACT.ZIDENTIFIER AS 'RECIPIENT IDENTIFIER',
      RECEIPIENTCONACT.ZPERSONID AS 'RECIPIENT PERSONID',
      ZINTERACTIONS.ZRECIPIENTCOUNT AS 'RECIPIENT COUNT',  
      ZINTERACTIONS.ZDOMAINIDENTIFIER AS 'DOMAIN IDENTIFIER',   
      ZINTERACTIONS.ZISRESPONSE AS 'IS RESPONSE',
      ZATTACHMENT.ZCONTENTTEXT AS 'CONTEXT TEXT',
      ZATTACHMENT.ZUTI AS 'UTI',
      ZATTACHMENT.ZCONTENTURL AS 'CONTENT URL',
      ZATTACHMENT.ZSIZEINBYTES AS 'SIZE IN BYTES',
      ZATTACHMENT.ZPHOTOLOCALIDENTIFIER AS 'PHOTO LOCAL IDENTIFIER',
      HEX(ZATTACHMENT.ZIDENTIFIER) AS 'ATTACHMENT ID',
      ZATTACHMENT.ZCLOUDIDENTIFIER AS 'CLOUD IDENTIFIER',
      ZCONTACTS.ZINCOMINGRECIPIENTCOUNT AS 'INCOMING RECIPIENT COUNT', 
      ZCONTACTS.ZINCOMINGSENDERCOUNT AS 'INCOMING SENDER COUNT', 
      ZCONTACTS.ZOUTGOINGRECIPIENTCOUNT AS 'OUTGOING RECIPIENT COUNT', 
      DATETIME(ZINTERACTIONS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZINTERACTIONS CREATION DATE',
      DATETIME(ZCONTACTS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZCONTACTS CREATION DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING SENDER DATE',
      DATETIME(ZCONTACTS.ZFIRSTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST OUTGOING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZLASTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'LAST INCOMING SENDER DATE',
      CASE ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE 
         WHEN '0' THEN '0' 
         ELSE DATETIME(ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') 
      END 'LAST INCOMING RECIPIENT DATE', 
      DATETIME(ZCONTACTS.ZLASTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'LAST OUTGOING RECIPIENT DATE', 
      ZCONTACTS.ZCUSTOMIDENTIFIER AS 'CUSTOM IDENTIFIER', 
      ZINTERACTIONS.ZCONTENTURL AS 'CONTENT URL', 
      ZINTERACTIONS.ZLOCATIONUUID AS 'LOCATION UUID', 
      ZINTERACTIONS.ZGROUPNAME AS 'GROUP NAME',
      ZINTERACTIONS.ZDERIVEDINTENTIDENTIFIER AS 'DERIVIED INTENT ID',
      ZINTERACTIONS.Z_PK AS 'ZINTERACTIONS TABLE ID' 
   FROM ZINTERACTIONS 
   LEFT JOIN ZCONTACTS ON ZINTERACTIONS.ZSENDER = ZCONTACTS.Z_PK
   LEFT JOIN Z_1INTERACTIONS ON ZINTERACTIONS.Z_PK == Z_1INTERACTIONS.Z_3INTERACTIONS
   LEFT JOIN ZATTACHMENT ON Z_1INTERACTIONS.Z_1ATTACHMENTS == ZATTACHMENT.Z_PK
   LEFT JOIN Z_2INTERACTIONRECIPIENT ON ZINTERACTIONS.Z_PK== Z_2INTERACTIONRECIPIENT.Z_3INTERACTIONRECIPIENT
   LEFT JOIN ZCONTACTS RECEIPIENTCONACT ON Z_2INTERACTIONRECIPIENT.Z_2RECIPIENTS== RECEIPIENTCONACT.Z_PK 

[SQL Query 12]
QUERY=
   SELECT
      DATETIME(ZINTERACTIONS.ZSTARTDATE + 978307200, 'UNIXEPOCH') AS 'START DATE',
      DATETIME(ZINTERACTIONS.ZENDDATE + 978307200, 'UNIXEPOCH') AS 'END DATE',
      ZINTERACTIONS.ZBUNDLEID AS 'BUNDLE ID',
         ZINTERACTIONS.ZACCOUNT AS 'ACCOUNT',
      ZINTERACTIONS.ZTARGETBUNDLEID AS 'TARGET BUNDLE ID',
      CASE ZINTERACTIONS.ZDIRECTION
         WHEN '0' THEN 'INCOMING'
         WHEN '1' THEN 'OUTGOING'
      END 'DIRECTION',
      ZCONTACTS.ZDISPLAYNAME AS 'SENDER DISPLAY NAME',
      ZCONTACTS.ZIDENTIFIER AS 'SENDER IDENTIFIER',
      ZCONTACTS.ZPERSONID AS 'SENDER PERSONID',
      RECEIPIENTCONACT.ZDISPLAYNAME AS 'RECIPIENT DISPLAY NAME',
      RECEIPIENTCONACT.ZIDENTIFIER AS 'RECIPIENT IDENTIFIER',
      RECEIPIENTCONACT.ZPERSONID AS 'RECIPIENT PERSONID',
      ZINTERACTIONS.ZRECIPIENTCOUNT AS 'RECIPIENT COUNT',  
      ZINTERACTIONS.ZDOMAINIDENTIFIER AS 'DOMAIN IDENTIFIER',  
      ZINTERACTIONS.ZISRESPONSE AS 'IS RESPONSE',
      ZATTACHMENT.ZCONTENTTEXT AS 'CONTEXT TEXT',
      ZATTACHMENT.ZUTI AS 'UTI',
      ZATTACHMENT.ZCONTENTURL AS 'CONTENT URL',
      ZATTACHMENT.ZSIZEINBYTES AS 'SIZE IN BYTES',
      HEX(ZATTACHMENT.ZIDENTIFIER) AS 'ATTACHMENT ID',
      ZATTACHMENT.ZCLOUDIDENTIFIER AS 'CLOUD IDENTIFIER',
            ZCONTACTS.ZINCOMINGRECIPIENTCOUNT AS 'INCOMING RECIPIENT COUNT', 
        ZCONTACTS.ZINCOMINGSENDERCOUNT AS 'INCOMING SENDER COUNT', 
         ZCONTACTS.ZOUTGOINGRECIPIENTCOUNT AS 'OUTGOING RECIPIENT COUNT', 
      DATETIME(ZINTERACTIONS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZINTERACTIONS CREATION DATE',
      DATETIME(ZCONTACTS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZCONTACTS CREATION DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING SENDER DATE',
      DATETIME(ZCONTACTS.ZFIRSTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST OUTGOING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZLASTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'LAST INCOMING SENDER DATE',
         CASE ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE 
            WHEN '0' THEN '0' 
            ELSE DATETIME(ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') 
         END 'LAST INCOMING RECIPIENT DATE', 
         DATETIME(ZCONTACTS.ZLASTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'LAST OUTGOING RECIPIENT DATE', 
         ZCONTACTS.ZCUSTOMIDENTIFIER AS 'CUSTOM IDENTIFIER', 
         ZINTERACTIONS.ZCONTENTURL AS 'CONTENT URL', 
         ZINTERACTIONS.ZLOCATIONUUID AS 'LOCATION UUID', 
         ZINTERACTIONS.Z_PK AS 'ZINTERACTIONS TABLE ID' 
      FROM
         ZINTERACTIONS 
         LEFT JOIN
            ZCONTACTS 
            ON ZINTERACTIONS.ZSENDER = ZCONTACTS.Z_PK
         LEFT JOIN Z_1INTERACTIONS ON ZINTERACTIONS.Z_PK == Z_1INTERACTIONS.Z_3INTERACTIONS
         LEFT JOIN ZATTACHMENT ON Z_1INTERACTIONS.Z_1ATTACHMENTS == ZATTACHMENT.Z_PK
         LEFT JOIN Z_2INTERACTIONRECIPIENT ON ZINTERACTIONS.Z_PK== Z_2INTERACTIONRECIPIENT.Z_3INTERACTIONRECIPIENT
         LEFT JOIN ZCONTACTS RECEIPIENTCONACT ON Z_2INTERACTIONRECIPIENT.Z_2RECIPIENTS== RECEIPIENTCONACT.Z_PK 

[SQL Query 10,11]
QUERY=
   SELECT
      DATETIME(ZINTERACTIONS.ZSTARTDATE + 978307200, 'UNIXEPOCH') AS 'START DATE',
      DATETIME(ZINTERACTIONS.ZENDDATE + 978307200, 'UNIXEPOCH') AS 'END DATE',
      ZINTERACTIONS.ZBUNDLEID AS 'BUNDLE ID',
      ZCONTACTS.ZDISPLAYNAME AS 'DISPLAY NAME',
      ZCONTACTS.ZIDENTIFIER AS 'IDENTIFIER',
      ZCONTACTS.ZPERSONID AS 'PERSONID',
      ZINTERACTIONS.ZDIRECTION AS 'DIRECTION',
      ZINTERACTIONS.ZISRESPONSE AS 'IS RESPONSE',
      ZINTERACTIONS.ZMECHANISM AS 'MECHANISM',
      ZINTERACTIONS.ZRECIPIENTCOUNT AS 'RECIPIENT COUNT',
      DATETIME(ZINTERACTIONS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZINTERACTIONS CREATION DATE',
      DATETIME(ZCONTACTS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZCONTACTS CREATION DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING SENDER DATE',
      DATETIME(ZCONTACTS.ZFIRSTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST OUTGOING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZLASTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'LAST INCOMING SENDER DATE',
      CASE
         ZLASTINCOMINGRECIPIENTDATE 
         WHEN
            '0' 
         THEN
            '0' 
         ELSE
            DATETIME(ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') 
      END AS 'LAST INCOMING RECIPIENT DATE', 
      DATETIME(ZCONTACTS.ZLASTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'LAST OUTGOING RECIPIENT DATE', 
      ZINTERACTIONS.ZACCOUNT AS 'ACCOUNT', 
      ZINTERACTIONS.ZDOMAINIDENTIFIER AS 'DOMAIN IDENTIFIER', 
      ZCONTACTS.ZINCOMINGRECIPIENTCOUNT AS 'INCOMING RECIPIENT COUNT', 
      ZCONTACTS.ZINCOMINGSENDERCOUNT AS 'INCOMING SENDER COUNT', 
      ZCONTACTS.ZOUTGOINGRECIPIENTCOUNT AS 'OUTGOING RECIPIENT COUNT', 
      ZCONTACTS.ZCUSTOMIDENTIFIER AS 'CUSTOM IDENTIFIER', 
      ZINTERACTIONS.ZCONTENTURL AS 'CONTENT URL', 
      ZINTERACTIONS.ZLOCATIONUUID AS 'LOCATION UUID', 
      ZINTERACTIONS.Z_PK AS 'ZINTERACTIONS TABLE ID' 
   FROM
      ZINTERACTIONS 
      LEFT JOIN
         ZCONTACTS 
         ON ZINTERACTIONS.ZSENDER = ZCONTACTS.Z_PK

[SQL Query 9]
QUERY=
   SELECT
      DATETIME(ZINTERACTIONS.ZSTARTDATE + 978307200, 'UNIXEPOCH') AS 'START DATE',
      DATETIME(ZINTERACTIONS.ZENDDATE + 978307200, 'UNIXEPOCH') AS 'END DATE',
      DATETIME(ZINTERACTIONS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZINTERACTIONS CREATION DATE',
      ZINTERACTIONS.ZBUNDLEID AS 'BUNDLE ID',
      ZCONTACTS.ZDISPLAYNAME AS 'DISPLAY NAME',
      ZCONTACTS.ZIDENTIFIER AS 'IDENTIFIER',
      ZCONTACTS.ZPERSONID AS 'PERSONID',
      ZINTERACTIONS.ZDIRECTION AS 'DIRECTION',
      ZINTERACTIONS.ZISRESPONSE AS 'IS RESPONSE',
      ZINTERACTIONS.ZMECHANISM AS 'MECHANISM',
      DATETIME(ZCONTACTS.ZCREATIONDATE + 978307200, 'UNIXEPOCH') AS 'ZCONTACTS CREATION DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZFIRSTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'FIRST INCOMING SENDER DATE',
      DATETIME(ZCONTACTS.ZFIRSTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'FIRST OUTGOING RECIPIENT DATE',
      DATETIME(ZCONTACTS.ZLASTINCOMINGSENDERDATE + 978307200, 'UNIXEPOCH') AS 'LAST INCOMING SENDER DATE',
      CASE
         ZLASTINCOMINGRECIPIENTDATE 
         WHEN
            '0' 
         THEN
            '0' 
         ELSE
            DATETIME(ZCONTACTS.ZLASTINCOMINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') 
      END AS 'LAST INCOMING RECIPIENT DATE', 
      DATETIME(ZCONTACTS.ZLASTOUTGOINGRECIPIENTDATE + 978307200, 'UNIXEPOCH') AS 'LAST OUTGOING RECIPIENT DATE', 
      ZINTERACTIONS.ZACCOUNT AS 'ACCOUNT', 
      ZINTERACTIONS.ZDOMAINIDENTIFIER AS 'DOMAIN IDENTIFIER', 
      ZCONTACTS.ZINCOMINGRECIPIENTCOUNT AS 'INCOMING RECIPIENT COUNT', 
      ZCONTACTS.ZINCOMINGSENDERCOUNT AS 'INCOMING SENDER COUNT', 
      ZCONTACTS.ZOUTGOINGRECIPIENTCOUNT AS 'OUTGOING RECIPIENT COUNT', 
      ZINTERACTIONS.ZCONTENTURL AS 'CONTENT URL', 
      ZINTERACTIONS.ZLOCATIONUUID AS 'LOCATION UUID', 
      ZINTERACTIONS.Z_PK AS 'ZINTERACTIONS TABLE ID' 
   FROM
      ZINTERACTIONS 
      LEFT JOIN
         ZCONTACTS 
         ON ZINTERACTIONS.ZSENDER = ZCONTACTS.Z_PK